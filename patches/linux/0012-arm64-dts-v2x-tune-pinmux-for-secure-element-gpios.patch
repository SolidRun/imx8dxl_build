From be8ee9a040071e40903b1564d7a63ed7f6a32d1e Mon Sep 17 00:00:00 2001
From: Josua Mayer <josua@solid-run.com>
Date: Thu, 6 Oct 2022 17:46:08 +0300
Subject: [PATCH 12/14] arm64: dts: v2x: tune pinmux for secure element gpios

Signed-off-by: Josua Mayer <josua@solid-run.com>
---
 .../boot/dts/freescale/imx8dxl-sr-som.dtsi     | 18 ++++++++++++------
 1 file changed, 12 insertions(+), 6 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/imx8dxl-sr-som.dtsi b/arch/arm64/boot/dts/freescale/imx8dxl-sr-som.dtsi
index f84959968e0b..836002ce8033 100644
--- a/arch/arm64/boot/dts/freescale/imx8dxl-sr-som.dtsi
+++ b/arch/arm64/boot/dts/freescale/imx8dxl-sr-som.dtsi
@@ -82,7 +82,6 @@ v2x_secure_reg_1v8: regulator-v2x-secure-1v8 {
 		regulator-max-microvolt = <1800000>;
 		gpio = <&lsio_gpio3 18 GPIO_ACTIVE_HIGH>;
 		enable-active-high;
-		regulator-always-on;
 	};
 };
 
@@ -294,8 +293,11 @@ pinctrl_v2x_secure: v2xsecuregrp {
 				/* v2x-secure-element reset: io with pull-up */
 				IMX8DXL_QSPI0B_DATA1_LSIO_GPIO3_IO19	0x0000021
 
-				/* v2x-secure-element gpio0: io without pull-up */
-				IMX8DXL_QSPI0B_DATA2_LSIO_GPIO3_IO20	0x0000061
+				/*
+				 * v2x-secure-element gpio0: io with pull-up
+				 * pulled low by sxf after boot indicating ready for commands
+				 */
+				IMX8DXL_QSPI0B_DATA2_LSIO_GPIO3_IO20	0x0000021
 
 				/* v2x-secure-element gpio1: io without pull-up */
 				IMX8DXL_QSPI0B_DATA3_LSIO_GPIO3_IO21	0x0000061
@@ -304,8 +306,12 @@ IMX8DXL_QSPI0B_DATA3_LSIO_GPIO3_IO21	0x0000061
 
 		pinctrl_v2x_secure_reg_1v8: v2xsecurereg1v8grp {
 			fsl,pins = <
-				/* v2x-secure-element power switch: io without pull-up */
-				IMX8DXL_QSPI0B_DATA0_LSIO_GPIO3_IO18	0x0000061
+				/*
+				 * v2x-secure-element power switch: io with pull-down
+				 * - keep SE powered off by default until SW is ready
+				 * - TODO: may be configured floating if external pull-down is valid
+				 */
+				IMX8DXL_QSPI0B_DATA0_LSIO_GPIO3_IO18	0x0000041
 			>;
 		};
 
@@ -339,7 +345,7 @@ v2x_secure_element: sxf1800@0 {
 		reg = <0>;
 		compatible = "rohm,dh2228fv";
 		spi-max-frequency = <30000000>;
-		power-supply = <&v2x_secure_reg_1v8>; // should be always on maybe?
+		power-supply = <&v2x_secure_reg_1v8>;
 	};
 };
 
-- 
2.37.3

